---
import Base from "@layouts/Base.astro";
import PageBanner from "@components/Banner/PageBanner.astro";
import PostCard from "@components/PostCard.astro";
import { queryFetch } from "@utils/queryFetch";
const { categoryName } = Astro.props;
const title = `搜尋結果：${categoryName}`;
const description = `搜尋頁面`;

  const filtedPosts = await queryFetch(`query Category ($targetCategory: String!){
  posts(filters: {categories:{name:{eq:$targetCategory}}}){
    data {
      attributes {
        featuredIcon {
          data {
            attributes {
              url
              width
              height
            }
          }
        }
        slug
        date
        titletc
        excerpt
        categories{
          data{
            attributes{
              name
              slug
            }
          }
        }
        content
      }
    }
  }
}
`, `{"targetCategory": "${categoryName}"}`).then((result) => result.data.posts.data);


export async function getStaticPaths() {
  const categories = await queryFetch(`{
	categories{
    data{
      attributes{
        name
        slug
      }
    }
  }
}
`).then((result) => result.data.categories.data);

  return categories.map((category) => {
    return {
      params: { slug: category.attributes.slug },
      props: {
        categoryName: category.attributes.name,
      },
    };
  });
}
---

<Base title={title} description={description}>
  <PageBanner title={title} />

  <section class="px-4">
    <div
      class="grid md:grid-cols-4 grid-cols-1 gap-y-4 md:gap-x-4 mt-8 md:mt-0"
    >
      {
        filtedPosts.map((post) => {
          return <PostCard post={post.attributes} />;
        })
      }
    </div>
  </section>
</Base>
